---
title: 那些易混淆的多线程概念
date: 2017-12-16 23:47:53
categories : 操作系统
---
在操作系统里进程和线程是比较重要的概念，对于它们的理解，建议看阮一峰老师一篇很形象的[讲解](http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)，以下进程和线程的概念借用了阮一峰老师的说法。

**进程**：（单核CPU前提下），CPU比作一个工厂，进程就是工厂里的车间。由于电力有限，一次只能有一个车间运作，即在同一时间点，只运行一个进程，其他进程处于非运行状态。

**线程**：一个车间里有很多工人，他们协同完成一个任务。就是说一个进程里包含多个线程。

工人都在一个车间里工作，车间里有很多小房间，都可以供工人进去。也就是说同一进程里的各种线程，他们使用的是公共的内存空间。但是小房间大小不同，有些房间如果里面有人，其他人就不能进去，说的就是一个线程在使用某些公共内存空间时，其他线程必须等它结束了，才能使用这块内存。为了防止他人进入干扰，最好的方式就是加锁，也就是互斥锁。

有些房间可以同时容纳N个人，多出来的人只能在外面等待，知道有人出去了才能进入。这就好比一些内存区域，可以同时让固定数量的线程访问。这时候就要使用**信号量**这个概念了，根据信号量，在外面的线程来判断要不要访问某个内存空间。


**任务**：就是一段可执行代码，执行的时候可分为同步和异步。

**队列**：用于存放任务，只负责任务的调度，不负责任务的执行。队列分为串行和并行。无论是串行和并行都满足FIFO的特点。

**串行**：存放在队列里的任务在某一时间点上，只能执行一个任务。

**并行**：存放在队列里的任务可以在同一时间点上同时执行多个任务

可以用下面图来表示并行与串行的差异
![](http://upload-images.jianshu.io/upload_images/921478-81a27fd0f05eb598.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**并发**： 并发和并行非常容易混淆，并发和并行有一个共同点，就是都具备处理多个任务的能力，但是并行可以同时处理多个任务，并发不能同时处理多个任务，即并行必然是并发，但是并发不一定是并行。那么并发和串行的区别在哪里？`两者都是同一时间点只能执行一个任务，串行必须任务A结束后才能执行任务B，而并发可以任务A执行到一半，暂停下来，执行任务B，等需要的时候再切换到任务A继续执行，即并发任务可中断后恢复执行，串行不能`（**以上是针对单核CPU,如果是双核，那么就可以一次执行两个任务，四核一次执行4个任务**）

![](http://upload-images.jianshu.io/upload_images/921478-5fc077033369ece4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**同步**：同步和异步都是针对于任务来说，同步任务不会开启新的线程，任务按顺序执行

**异步**：会开启新的线程，任务可以并行执行。

对**同步**，**异步**，**串行**，**并行**进行组合，可以有以下几种：

**同步任务加入串行队列**：实现的效果即是任务一个接一个按顺序执行。

**同步任务加入并行队列**：虽然并行队列可以同时执行多个任务，但是同步任务不会开启新的线程，所以当并行队列里只有同步效果也是任务一个接一个按顺序执行，当并行队列里既然有同步任务，又有异步任务时，对于异步任务来说，同一时间点可以执行多个异步任务。对于那些同步任务来说，同一时间点只能执行一个。如下图：
![](http://upload-images.jianshu.io/upload_images/921478-266ecf70cb0baa6f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**异步任务加入串行队列**：虽然异步任务有多个线程，但是在串行队列里，只能同时执行一个任务，所以也是任务一个接一个,但是并不会完全按照顺序，如果串行队列里既有同步任务，又有异步任务，那么同步任务会按顺序执行完毕后再执行异步任务。

**异步任务加入并行队列**：这是最理想的异步执行方案。可以实现在同一时间点同时执行多个任务。

