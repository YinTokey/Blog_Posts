---
title: C语言中数组与指针的异同
date: 2017-10-30 21:52:15
categories: C
---

C语言的数组和指针一直是两个容易混淆的东西，当初在学习的时候，也许为了通过考试会对指针和数组的一些考点进行突击，但是很多极其细节的东西也许并不是那么清楚。本篇侧重点在于分析数组与指针的关系，什么时候数组可以等同于指针，什么时候二者不同。

## 数组的访问
首先通过一张图来描述一下数组的访问过程,下图的字符数组，访问下标为9的的元素

![](http://ww2.sinaimg.cn/large/006tNc79gy1fl1w00tfu3j30kl07zmxj.jpg)


<figure class="third">
<img src="http://ww4.sinaimg.cn/large/006tNc79gy1fl1w4175l4j308w08wt8n.jpg">
<img src="http://ww3.sinaimg.cn/large/006tNc79gy1fl1wgjwv1qj308c08cdft.jpg">
<img src="http://ww4.sinaimg.cn/large/006tNc79gy1fl1wonyt65j308c08cmx4.jpg">
<img src="http://ww4.sinaimg.cn/large/006tNc79gy1fl1wox3d1fj308c08c3yi.jpg">
</figure>

`需要注意的是如果其他类型的变量，那么偏移量的计算应该是 i*单变量字节数，比如char是一个字节，int是4字节，那么int类型数组计算地址是，应该是加上偏移量 i*4`

## 指针的访问
下面是访问指针的例子:
![](http://ww1.sinaimg.cn/large/006tNc79gy1fla0okd8dkj307f04l3yf.jpg)

符号表里有一个符号p，它的地址为4040
运行时，先取4040的内容，即9910。然后在取地址9910的内容，即取到指针所指向的地址的内容。
`也就是说指针的取值，多了一个提取步骤`


## 二者差异特性总结

指针 | 数组
------- | -------
保存地址 | 保存数据
定义时，只为指针本身分配空间（4字节），不为它所指向的的对象分配空间。除非像char *p = "aaaa" 这类顺便把字符串也初始化的情况，同时需要注意对于非字符常量，不能采取这种方式。比如 float *p = 1.11；这种写法会编译器会报错|初始化时分配整个数组需要的空间
通过指针的内容值作为地址，间接访问数据|通过数组下标直接访问数据
char *p = "aaaa"这一类初始化，该字符串会被定义为只读，无法修改|char a[]= "aaaa"如果是数组这么定义，那么是可以对单个字符进行修改的，通过strncpy等函数来操作

## 什么时候二者可以相互替换
我们常常把指针和数组混淆，比如以下这种情况，定义为指针，却使用了数组的方式来取值。
```
char *p = "pointertest";
c = p[i];
```
定义为指针，但是使用数组的方式来取值。我们可以结合以上两种方式，来分析这种情况下的取值过程：
1.先根据符号p的地址，取到符号p的值，是一个地址，我们假设为4040，也就是和上面第二种情况的指针访问一样。
2.接下来就是4040+i,得到新的地址值
3.取新的地址的内容
`同理，取偏移地址的时候，需要注意变量类型，比如int类型，就是加上 i*4`

以下对于二者可相互替换做一个总结

- extern char a[];通过extern声明的数组，不能用指针形式替换
- 数组定义为 char a[5],不能用指针的形式替换
- 数组作为函数参数，可以使用指针形式替换
- 在表达式中，比如c = a[i]，这种情况也可以使用指针形式来替换，因为在表达式中，数组名a被当做指向该数组第一个元素的指针，所以可以和指针相互替换。而且数组下标i可以和指针的偏移量等同起来，a[i]等同于 *(a+i)

